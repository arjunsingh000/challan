<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challan Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @page {
            size: A4;
            margin: 0;
        }
        @media print {
            body {
                margin: 0;
            }
            body * {
                visibility: hidden;
            }
            #challan-template, #challan-template * {
                visibility: visible;
            }
            #challan-template {
                position: absolute;
                left: 0;
                top: 0;
                width: 210mm;
                height: 297mm;
                font-family: 'Inter', sans-serif;
                box-sizing: border-box;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                page-break-inside: avoid;
            }
            .print-hidden {
                display: none;
            }
            .challan-page {
                border: 1px solid black;
                padding: 1rem;
                margin: 0.5rem;
                background-color: white;
                height: 100%;
                display: flex;
                flex-direction: column;
                box-sizing: border-box;
                page-break-inside: avoid;
            }
            .challan-table, .challan-table tr {
                page-break-inside: avoid;
            }
        }
        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
        }
        input, select, textarea {
            border-radius: 0.5rem;
        }
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <script>
        let uiElements = {};
        const defaultCompanies = {
            "Centruy Technology": {
                address: "Plot -69 ,Sec - 69, Imt Faridabad 121005, Haryana",
                gst: "06AAEFC7107N1ZD"
            },
            "Sood Associates ": {
                address: "Plot - 06 ,Samaypur Road ,Faridabad 121005, Haryana",
                gst: "06ABSPC4041J1ZP"
            },
            "Smitha Surgicals India Pvt Ltd": {
                address: "Plot -111 ,Sec- 59 Faridabad 121005 , Haryana",
                gst: "06AAECS9224K1Z3"
            },
            "Saifi Con Fab System Pvt Ltd": {
                address: "Plot - 86-87 ,Sarurpur Industrial Area Faridabad",
                gst: "06AAHCS3347L1Z2"
            }
        };
        const productsByCompany = {
            "Centruy Technology": [
                "Bearing sleeve c118078/5",
                "Bearing sleeve c64790/1 (item - 00470)",
                "Bolzeen Pin",
                "Bush B76952 (item - 00800)",
                "Clamp Sleeve 47133558",
                "Connecting Socket KP0056067 (item - 1010)",
                "Control Shaft",
                "Cyclonic Stud",
                "Cylinder Blank 37506198",
                "Guide c114621 (item - 00490)",
                "Pin c20882(item - 00180)",
                "Pin 3T40426R110 (item - 1410)",
                "Piston c101576 (item - 00520)",
                "Push Rod c73773/1 (item -00290)",
                "Push Rod C73773/6 (item - 1190)",
                "Ring KP0049400 (item - 1000)",
                "Shaft Steel 772132",
                "Shaft MLK/ 03943388",
                "Snap Head Rivet I.H.0006/1",
                "Spacer c20547",
                "Spacer Bushing B51882/4 (item - 700)",
                "Spacer Bushing B51882/3",
                "Spacer Socket B51882/3",
                "Tapper B57490",
                "Tappet B57490 (item - 1510)",
                "Tappet B65635",
                "Valve Pin B58165/KI (item - 00780)",
                "Volve Head Pin"
            ],
            "Saifi Con Fab System Pvt Ltd": [
                "Hing Bush"
            ],
            "Sood Associates ": [
                "Control Shaft"
            ]
        };
        let companies = JSON.parse(localStorage.getItem('companies')) || defaultCompanies;
        
        function showMessage(message) {
            const statusMessage = document.getElementById('status-message');
            statusMessage.textContent = message;
            statusMessage.classList.add('opacity-100');
            setTimeout(() => {
                statusMessage.classList.remove('opacity-100');
            }, 3000);
        }
        // --- UI & Form Handling Functions ---
        function addProductRow(product = { description: '', hsn: '', qty: '' }) {
            const rowCount = uiElements.productRowsContainer.children.length;
            const newRow = document.createElement('div');
            newRow.className = 'product-row grid grid-cols-1 md:grid-cols-4 gap-4 bg-gray-100 p-4 rounded-md border border-gray-200 relative';
            newRow.innerHTML = `
                <div>
                    <label class="block text-sm font-medium text-gray-700">Sr. No.</label>
                    <input type="text" value="${rowCount + 1}" disabled class="mt-1 block w-full border-gray-300 rounded-md p-2 bg-gray-200 cursor-not-allowed product-sr-no">
                </div>
                <div class="col-span-1 md:col-span-2 relative">
                    <label class="block text-sm font-medium text-gray-700">Description of Goods</label>
                    <select onchange="handleProductSelection(this)" class="mt-1 block w-full border-gray-300 rounded-md p-2 product-description">
                        <option value="">Select a product</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">HSN code</label>
                    <input type="text" value="${product.hsn}" class="mt-1 block w-full border-gray-300 rounded-md p-2 product-hsn">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Qty.</label>
                    <input type="text" value="${product.qty}" class="mt-1 block w-full border-gray-300 rounded-md p-2 product-qty">
                </div>
                <button onclick="removeProductRow(this)" class="absolute top-2 right-2 p-1 text-red-500 hover:text-red-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
            `;
            uiElements.productRowsContainer.appendChild(newRow);
            const selectEl = newRow.querySelector('.product-description');
            populateProductDropdowns(selectEl);
            if (product.description) {
                selectEl.value = product.description;
            }
        }
        function removeProductRow(button) {
            const row = button.closest('.product-row');
            if (row) {
                row.remove();
                updateSrNo();
            }
        }
        function updateSrNo() {
            const srNoInputs = document.querySelectorAll('.product-sr-no');
            srNoInputs.forEach((input, index) => {
                input.value = index + 1;
            });
        }
        function handleProductSelection(selectElement) {
            if (selectElement.value === 'new-product') {
                const parent = selectElement.parentElement;
                
                const container = document.createElement('div');
                container.className = 'flex items-center space-x-2 w-full';
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'mt-1 block w-full border-gray-300 rounded-md p-2 product-description';
                input.placeholder = 'Enter new product name...';
                
                const revertButton = document.createElement('button');
                revertButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 hover:text-gray-700 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m5.253 9H4.582a8.001 8.001 0 0015.356-2m-6.321-2H17.5a2.5 2.5 0 002.5-2.5v-7.5" />
                                        </svg>`;
                revertButton.className = 'revert-button';
                revertButton.type = 'button';
                revertButton.onclick = () => {
                    const productSelect = document.createElement('select');
                    productSelect.className = 'mt-1 block w-full border-gray-300 rounded-md p-2 product-description';
                    productSelect.onchange = () => handleProductSelection(productSelect);
                    parent.replaceChild(productSelect, container);
                    populateProductDropdowns(productSelect);
                };
                
                container.appendChild(input);
                container.appendChild(revertButton);
                parent.replaceChild(container, selectElement);
            }
        }
        function generateChallan() {
            const companyName = uiElements.companiesSelect.value;
            const challanNo = uiElements.challanNo.value;
            const clientChallanNo = uiElements.clientChallanNo.value;
            const challanDate = uiElements.challanDate.value;
            const vehicleNo = uiElements.vehicleNo.value;
            
            // Validate main fields
            if (!companyName || !challanNo || !challanDate || !clientChallanNo || !vehicleNo) {
                return showMessage('Please fill in all the top-level form fields.');
            }
            
            const products = Array.from(document.querySelectorAll('#product-rows .product-row'));
            
            // Validate products
            if (products.length === 0) {
                return showMessage('Please add at least one product.');
            }
            
            const validatedProducts = [];
            for (const row of products) {
                const descriptionElement = row.querySelector('.product-description');
                let description = '';
                if (descriptionElement.tagName === 'SELECT') {
                    description = descriptionElement.value;
                } else {
                    description = descriptionElement.value;
                }
                const hsn = row.querySelector('.product-hsn').value;
                const qty = row.querySelector('.product-qty').value;
                
                if (!description || !hsn || !qty) {
                    return showMessage('Please fill in all product details (Description, HSN, Qty) for each row.');
                }
                validatedProducts.push({ description, hsn, qty });
            }
            
            const challanData = {
                companyName,
                companyAddress: uiElements.companyAddress.value,
                gstNo: uiElements.gstNo.value,
                challanNo,
                clientChallanNo,
                challanDate,
                vehicleNo,
                products: validatedProducts,
                createdAt: Date.now()
            };

            // Calculate the NEXT challan number and save it for persistence on refresh
            const nextChallanNo = (parseInt(challanNo) + 1).toString().padStart(3, '0');
            localStorage.setItem('lastChallanNo', nextChallanNo);
            
            renderPrintableChallan(challanData);
            
            // NOTE: The line `uiElements.challanNo.value = nextChallanNo;` has been removed
            // so the input field does not update until the page is refreshed.
        }
        function renderPrintableChallan(data) {
            document.getElementById('challan-template-company-name').textContent = data.companyName;
            document.getElementById('challan-template-company-address').textContent = data.companyAddress;
            document.getElementById('challan-template-gst-no').textContent = data.gstNo;
            document.getElementById('challan-template-challan-no').textContent = data.challanNo;
            document.getElementById('challan-template-client-challan-no').textContent = data.clientChallanNo;
            
            const [year, month, day] = data.challanDate.split('-');
            document.getElementById('challan-template-date').textContent = `${day}/${month}/${year}`;
            
            document.getElementById('challan-template-vehicle-no').textContent = data.vehicleNo;
            const productListContainer = document.getElementById('challan-product-list');
            productListContainer.innerHTML = '';
            data.products.forEach((product, index) => {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td class="p-2 border-r border-l border-black align-top">${index + 1}</td>
                    <td class="p-2 border-r border-black align-top">${product.description}</td>
                    <td class="p-2 border-r border-black align-top">${product.hsn}</td>
                    <td class="p-2 border-r border-black align-top">${product.qty}</td>
                `;
                productListContainer.appendChild(newRow);
            });
            const totalRows = 20;
            const emptyRowsToAdd = totalRows - data.products.length - 1;
            
            for (let i = 0; i < emptyRowsToAdd; i++) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td class="p-2 border-r border-l border-black">&nbsp;</td>
                    <td class="p-2 border-r border-black">&nbsp;</td>
                    <td class="p-2 border-r border-black">&nbsp;</td>
                    <td class="p-2 border-r border-black">&nbsp;</td>
                `;
                productListContainer.appendChild(emptyRow);
            }
            const jobWorkRow = document.createElement('tr');
            jobWorkRow.innerHTML = `<td colspan="4" class="p-2 text-left align-bottom border-t border-b border-l border-r border-black">JOB WORK ONLY</td>`;
            productListContainer.appendChild(jobWorkRow);
            uiElements.challanTemplate.classList.remove('hidden');
        }
        function clearForm() {
            uiElements.companiesSelect.value = '';
            uiElements.companyAddress.value = '';
            uiElements.gstNo.value = '';
            // Don't reset challan number here to maintain persistence
            uiElements.clientChallanNo.value = '';
            uiElements.challanDate.value = new Date().toISOString().split('T')[0];
            uiElements.vehicleNo.value = '';
            uiElements.productRowsContainer.innerHTML = '';
            addProductRow();
        }
        function populateCompanies() {
            uiElements.companiesSelect.innerHTML = '<option value="">Select a company</option>';
            for (const name in companies) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                uiElements.companiesSelect.appendChild(option);
            }
        }
        function openManageCompaniesModal() {
            renderCompanyListInModal();
            uiElements.manageCompaniesModal.style.display = 'flex';
        }
        function closeModal() {
            uiElements.manageCompaniesModal.style.display = 'none';
            uiElements.newCompanyName.value = '';
            uiElements.newCompanyAddress.value = '';
            uiElements.newCompanyGst.value = '';
        }
        function saveNewCompany() {
            const newCompanyName = uiElements.newCompanyName.value.trim();
            const newCompanyAddress = uiElements.newCompanyAddress.value.trim();
            const newCompanyGst = uiElements.newCompanyGst.value.trim();
            
            if (!newCompanyName || !newCompanyAddress || !newCompanyGst) {
                showMessage("All fields are required to add a new company.");
                return;
            }
            
            companies[newCompanyName] = {
                address: newCompanyAddress,
                gst: newCompanyGst
            };
            
            localStorage.setItem('companies', JSON.stringify(companies));
            populateCompanies();
            renderCompanyListInModal();
            
            uiElements.newCompanyName.value = '';
            uiElements.newCompanyAddress.value = '';
            uiElements.newCompanyGst.value = '';
            showMessage("New company added successfully!");
        }
        function removeCompany(companyName) {
            delete companies[companyName];
            localStorage.setItem('companies', JSON.stringify(companies));
            
            populateCompanies();
            renderCompanyListInModal();
            if (uiElements.companiesSelect.value === companyName) {
                uiElements.companyAddress.value = '';
                uiElements.gstNo.value = '';
            }
            showMessage(`'${companyName}' has been removed.`);
        }
        function renderCompanyListInModal() {
            uiElements.companyListToRemove.innerHTML = '';
            const companyNames = Object.keys(companies).sort();
            
            if (companyNames.length === 0) {
                uiElements.companyListToRemove.innerHTML = '<p class="text-gray-500 text-sm">No companies to remove.</p>';
                return;
            }
            companyNames.forEach(name => {
                const companyItem = document.createElement('div');
                companyItem.className = 'flex items-center justify-between bg-gray-100 p-2 rounded-md';
                companyItem.innerHTML = `
                    <span class="text-sm">${name}</span>
                    <button onclick="removeCompany('${name}')" class="bg-red-500 text-white text-xs px-2 py-1 rounded-md hover:bg-red-600 transition-colors">Remove</button>
                `;
                uiElements.companyListToRemove.appendChild(companyItem);
            });
        }
        function populateProductDropdowns(selectEl) {
            const selectedCompany = uiElements.companiesSelect.value;
            const products = productsByCompany[selectedCompany] || [];
            if (selectEl.tagName === 'SELECT') {
                const currentValue = selectEl.value;
                selectEl.innerHTML = '<option value="">Select a product</option>';
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product;
                    option.textContent = product;
                    selectEl.appendChild(option);
                });
                const newProductOption = document.createElement('option');
                newProductOption.value = 'new-product';
                newProductOption.textContent = 'Type a new product...';
                selectEl.appendChild(newProductOption);
                
                if (products.includes(currentValue)) {
                    selectEl.value = currentValue;
                }
            }
        }
        function openResetModal() {
            uiElements.resetModal.style.display = 'flex';
            uiElements.newChallanNoInput.focus();
        }

        function closeResetModal() {
            uiElements.resetModal.style.display = 'none';
        }

        function resetChallanNumber() {
            const newNumber = uiElements.newChallanNoInput.value.trim();
            if (!newNumber || isNaN(parseInt(newNumber))) {
                showMessage("Please enter a valid number.");
                return;
            }
            const paddedNumber = newNumber.padStart(3, '0');
            localStorage.setItem('lastChallanNo', paddedNumber);
            uiElements.challanNo.value = paddedNumber;
            closeResetModal();
            showMessage(`Challan number reset to ${paddedNumber}.`);
        }
        window.onload = () => {
             uiElements = {
                mainForm: document.getElementById('main-form'),
                companiesSelect: document.getElementById('company-name'),
                companyAddress: document.getElementById('company-address'),
                gstNo: document.getElementById('gst-no'),
                challanNo: document.getElementById('challan-no'),
                clientChallanNo: document.getElementById('client-challan-no'),
                challanDate: document.getElementById('challan-date'),
                vehicleNo: document.getElementById('vehicle-no'),
                productRowsContainer: document.getElementById('product-rows'),
                challanTemplate: document.getElementById('challan-template'),
                manageCompaniesModal: document.getElementById('manage-companies-modal'),
                newCompanyName: document.getElementById('new-company-name'),
                newCompanyAddress: document.getElementById('new-company-address'),
                newCompanyGst: document.getElementById('new-company-gst'),
                companyListToRemove: document.getElementById('company-list-to-remove'),
                resetModal: document.getElementById('reset-challan-modal'),
                newChallanNoInput: document.getElementById('new-challan-no-input')
            };

            // Get the last saved challan number from localStorage
            const lastChallanNo = localStorage.getItem('lastChallanNo');
            // If a number exists, set the input field to that number. Otherwise, start at 1.
            uiElements.challanNo.value = lastChallanNo ? lastChallanNo : '001';

            clearForm();
            populateCompanies();
            // Event Listeners
            uiElements.companiesSelect.addEventListener('change', (event) => {
                const selectedCompany = event.target.value;
                if (companies[selectedCompany]) {
                    uiElements.companyAddress.value = companies[selectedCompany].address;
                    uiElements.gstNo.value = companies[selectedCompany].gst;
                } else {
                    uiElements.companyAddress.value = '';
                    uiElements.gstNo.value = '';
                }
                document.querySelectorAll('.product-description').forEach(populateProductDropdowns);
            });
            // Expose functions to the global scope for event handlers in HTML
            window.generateChallan = generateChallan;
            window.addProductRow = () => addProductRow();
            window.removeProductRow = removeProductRow;
            window.clearForm = clearForm;
            window.openManageCompaniesModal = openManageCompaniesModal;
            window.closeModal = closeModal;
            window.saveNewCompany = saveNewCompany;
            window.removeCompany = removeCompany;
            window.handleProductSelection = handleProductSelection;
            window.openResetModal = openResetModal;
            window.closeResetModal = closeResetModal;
            window.resetChallanNumber = resetChallanNumber;
        };
    </script>
    <div class="container mx-auto p-4 md:p-8 print-hidden">
        <div id="main-form" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8">
            <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Challan Details</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="flex flex-col">
                    <label for="company-name" class="block text-sm font-medium text-gray-700">Party's Name ($M/s$)</label>
                    <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mt-1">
                        <select id="company-name" class="block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">Select a company</option>
                        </select>
                        <button onclick="openManageCompaniesModal()" class="bg-blue-600 text-white p-2 rounded-md shadow-sm hover:bg-blue-700 transition-colors text-sm font-bold whitespace-nowrap">Manage</button>
                    </div>
                </div>
                <div>
                    <label for="company-address" class="block text-sm font-medium text-gray-700">Party's Address</label>
                    <input type="text" id="company-address" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-100 cursor-not-allowed" disabled>
                </div>
                <div>
                    <label for="gst-no" class="block text-sm font-medium text-gray-700">GST No.</label>
                    <input type="text" id="gst-no" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 bg-gray-100 cursor-not-allowed" disabled>
                </div>
                <div>
                    <label for="challan-no" class="block text-sm font-medium text-gray-700">Our Challan No.</label>
                    <input type="text" id="challan-no" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="client-challan-no" class="block text-sm font-medium text-gray-700">Ch. No.</label>
                    <input type="text" id="client-challan-no" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="challan-date" class="block text-sm font-medium text-gray-700">Date</label>
                    <input type="date" id="challan-date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div>
                    <label for="vehicle-no" class="block text-sm font-medium text-gray-700">Vehicle No.</label>
                    <input type="text" id="vehicle-no" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
            </div>
            <div class="border-t border-gray-200 pt-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Products</h2>
                <div id="product-rows" class="space-y-4">
                    <!-- Product rows will be added here -->
                </div>
                <button onclick="addProductRow()" class="mt-4 w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition-colors">Add Product</button>
            </div>
        </div>
        <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4">
            <button onclick="generateChallan()" class="bg-green-600 text-white py-2 px-6 rounded-md shadow-lg hover:bg-green-700 transition-colors">Generate Challan</button>
            <button onclick="window.print()" class="bg-gray-600 text-white py-2 px-6 rounded-md shadow-lg hover:bg-gray-700 transition-colors">Print</button>
            <button onclick="openResetModal()" class="bg-gray-600 text-white py-2 px-6 rounded-md shadow-lg hover:bg-gray-700 transition-colors">Reset Challan No.</button>
        </div>
    </div>
    <!-- Manage Companies Modal -->
    <div id="manage-companies-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Manage Companies</h2>
            
            <div class="space-y-4 mb-8">
                <h3 class="text-xl font-semibold text-gray-800">Add New Company</h3>
                <div>
                    <label for="new-company-name" class="block text-sm font-medium text-gray-700">Company Name</label>
                    <input type="text" id="new-company-name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="new-company-address" class="block text-sm font-medium text-gray-700">Address</label>
                    <input type="text" id="new-company-address" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="new-company-gst" class="block text-sm font-medium text-gray-700">GST No.</label>
                    <input type="text" id="new-company-gst" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="flex justify-end space-x-2 mt-6">
                    <button onclick="saveNewCompany()" class="bg-green-600 text-white py-2 px-4 rounded-md shadow-lg hover:bg-green-700 transition-colors">Save New</button>
                </div>
            </div>
            <hr class="border-t border-gray-200">
            <div class="space-y-4 mt-8">
                <h3 class="text-xl font-semibold text-gray-800">Remove Existing Company</h3>
                <div id="company-list-to-remove" class="space-y-2">
                    <!-- Company list will be dynamically added here -->
                </div>
            </div>
            <div class="flex justify-end mt-6">
                <button onclick="closeModal()" class="bg-gray-600 text-white py-2 px-4 rounded-md shadow-lg hover:bg-gray-700 transition-colors">Close</button>
            </div>
        </div>
    </div>
    <!-- Reset Challan Modal -->
    <div id="reset-challan-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Reset Challan Number</h2>
            <p class="mb-4">Enter the number you want to start from. The challan number will be updated immediately.</p>
            <div>
                <label for="new-challan-no-input" class="block text-sm font-medium text-gray-700">Starting Challan No.</label>
                <input type="text" id="new-challan-no-input" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="flex justify-end space-x-2 mt-6">
                <button onclick="resetChallanNumber()" class="bg-green-600 text-white py-2 px-4 rounded-md shadow-lg hover:bg-green-700 transition-colors">Save</button>
                <button onclick="closeResetModal()" class="bg-gray-600 text-white py-2 px-4 rounded-md shadow-lg hover:bg-gray-700 transition-colors">Cancel</button>
            </div>
        </div>
    </div>
    <!-- Challan Template Section -->
    <div id="challan-template" class="hidden">
        <div class="challan-page">
            <div class="text-center font-bold text-xs">Challan</div>
            <div class="flex justify-between items-start mb-4">
                <div class="text-xs w-1/3"></div>
                <div class="text-center w-1/3">
                    <h2 class="font-bold text-xl">R.S. Engineering Works</h2>
                    <p class="text-xs whitespace-nowrap">
                        Spl.in: Centerless Grinding, Drilling & Turning
                    </p>
                    <p class="text-xs">
                        MCF-2428/12, Gali no. 28, Sanjay Colony, Sector - 23, Faridabad - 121005, Haryana
                    </p>
                    <p class="text-xs">GSTIN: 06AMMPP4291N1ZB</p>
                </div>
                <div class="text-right w-1/3">
                    <p class="text-xs font-bold">Mob.- 9871049290</p>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-sm mb-4">
                <div>
                    <p><strong>Ch:</strong><span id="challan-template-challan-no" class="text-lg"></span></p>
                    <p><strong class="text-lg">M/s:</strong><span id="challan-template-company-name" class="ml-2 text-lg font-semibold"></span></p>
                    <p><span id="challan-template-company-address"></span></p>
                    <p><strong>Ch. No:</strong><span id="challan-template-client-challan-no"></span></p>
                </div>
                <div class="flex flex-col items-end text-sm">
                    <div class="flex items-center">
                        <strong class="text-right w-24 text-lg">Date:</strong>
                        <span id="challan-template-date" class="ml-2 text-lg"></span>
                    </div>
                    <div class="flex items-center">
                        <strong class="text-right w-24">Vehicle No:</strong>
                        <span id="challan-template-vehicle-no" class="ml-2"></span>
                    </div>
                    <div class="flex items-center">
                        <strong class="text-right w-24">GST No:</strong>
                        <span id="challan-template-gst-no" class="ml-2"></span>
                    </div>
                </div>
            </div>
            <!-- Product Table -->
            <table class="w-full text-sm border-collapse table-fixed h-full border border-black challan-table">
                <thead>
                    <tr>
                        <th class="w-[8%] text-left p-2 border-r border-black border-b border-t-0">Sr. No.</th>
                        <th class="w-[50%] text-left p-2 border-r border-black border-b border-t-0">Description of Goods</th>
                        <th class="w-[21%] text-left p-2 border-r border-black border-b border-t-0">HSN code</th>
                        <th class="w-[21%] text-left p-2 border-r border-black border-b border-t-0">Qty.</th>
                    </tr>
                </thead>
                <tbody id="challan-product-list" class="text-sm">
                    <!-- Dynamic product rows and empty rows will be injected here by JS -->
                </tbody>
            </table>
            
            <div class="grid grid-cols-2 gap-4 text-sm mt-auto pt-4">
                <div>
                    <p>Received the above goods in order and condition</p>
                    <p class="mt-8">Reciever's Signature</p>
                </div>
                <div class="text-right">
                    <p>For R.S. ENGINEERING WORKS</p>
                    <p class="mt-8">Authority Signatory</p>
                </div>
            </div>
        </div>
    </div>
    <div id="status-message" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-md shadow-xl transition-opacity duration-300 opacity-0"></div>
</body>
</html>
